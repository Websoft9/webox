name: ğŸ” PR Check

on:
  pull_request:
    branches: [main, develop]
    types: [opened, synchronize, reopened, edited]

# æ·»åŠ å¿…è¦çš„æƒé™
permissions:
  contents: read
  pull-requests: write
  issues: write
  checks: write

env:
  GO_VERSION: "1.24.5"
  COVERAGE_THRESHOLD: 80

jobs:
  # æäº¤æ¶ˆæ¯æ ¼å¼æ£€æŸ¥
  commit-message-check:
    name: ğŸ“ Commit Message Check
    runs-on: ubuntu-latest
    if: github.event.action != 'edited'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check commit messages
        run: |
          echo "æ£€æŸ¥æäº¤æ¶ˆæ¯æ ¼å¼..."

          # è·å– PR ä¸­çš„æ‰€æœ‰æäº¤
          commits=$(git rev-list --reverse ${{ github.event.pull_request.base.sha }}..${{ github.event.pull_request.head.sha }})

          failed_commits=()

          for commit in $commits; do
            message=$(git log --format=%s -n 1 $commit)
            echo "æ£€æŸ¥æäº¤: $commit"
            echo "æ¶ˆæ¯: $message"

            if ! ./scripts/check-commit-message.sh "$message"; then
              failed_commits+=("$commit: $message")
            fi
          done

          if [ ${#failed_commits[@]} -gt 0 ]; then
            echo "âŒ ä»¥ä¸‹æäº¤æ¶ˆæ¯æ ¼å¼ä¸æ­£ç¡®:"
            for failed in "${failed_commits[@]}"; do
              echo "  - $failed"
            done
            echo ""
            echo "è¯·ä¿®æ”¹æäº¤æ¶ˆæ¯ä»¥ç¬¦åˆ Conventional Commits è§„èŒƒ:"
            echo "æ ¼å¼: <type>[optional scope]: <description>"
            echo "ç¤ºä¾‹: feat(auth): add JWT token refresh mechanism"
            exit 1
          fi

          echo "âœ… æ‰€æœ‰æäº¤æ¶ˆæ¯æ ¼å¼æ­£ç¡®"

  # ä»£ç æ ¼å¼æ£€æŸ¥
  code-format-check:
    name: ğŸ¨ Code Format Check
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}
          cache: true
          cache-dependency-path: |
            api-service/go.sum
            websoft9-agent/go.sum

      - name: Check Go formatting
        run: |
          echo "æ£€æŸ¥ Go ä»£ç æ ¼å¼..."

          # æ£€æŸ¥ api-service
          cd api-service
          unformatted=$(gofmt -l .)
          if [ -n "$unformatted" ]; then
            echo "âŒ api-service ä»¥ä¸‹æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®:"
            echo "$unformatted"
            exit 1
          fi

          # æ£€æŸ¥ websoft9-agent
          cd ../websoft9-agent
          unformatted=$(gofmt -l .)
          if [ -n "$unformatted" ]; then
            echo "âŒ websoft9-agent ä»¥ä¸‹æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®:"
            echo "$unformatted"
            exit 1
          fi

          echo "âœ… Go ä»£ç æ ¼å¼æ­£ç¡®"

      - name: Run golangci-lint for api-service
        uses: golangci/golangci-lint-action@v6
        with:
          version: latest
          working-directory: api-service
          args: --timeout=5m --out-format=github-actions

      - name: Run golangci-lint for websoft9-agent
        uses: golangci/golangci-lint-action@v6
        with:
          version: latest
          working-directory: websoft9-agent
          args: --timeout=5m --out-format=github-actions

  # å•å…ƒæµ‹è¯•
  unit-tests:
    name: ğŸ§ª Unit Tests
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write
    strategy:
      matrix:
        go-version: ["1.24.5"]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Go ${{ matrix.go-version }}
        uses: actions/setup-go@v5
        with:
          go-version: ${{ matrix.go-version }}
          cache: true
          cache-dependency-path: |
            api-service/go.sum
            websoft9-agent/go.sum

      - name: Run unit tests for api-service
        working-directory: api-service
        run: |
          echo "è¿è¡Œ api-service å•å…ƒæµ‹è¯•..."
          mkdir -p reports

          # è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
          go test -v -race -coverprofile=reports/coverage.out -covermode=atomic ./... | tee reports/test-results.txt

          # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
          if [ -f "reports/coverage.out" ]; then
            go tool cover -html=reports/coverage.out -o reports/coverage.html
            go tool cover -func=reports/coverage.out > reports/coverage.txt

            # è®¡ç®—æ€»è¦†ç›–ç‡
            total_coverage=$(go tool cover -func=reports/coverage.out | grep "total:" | awk '{print $3}' | sed 's/%//' || echo "0")
            echo "API Service æ€»è¦†ç›–ç‡: ${total_coverage}%"
            echo "api_coverage=$total_coverage" >> $GITHUB_ENV
          fi

      - name: Run unit tests for websoft9-agent
        working-directory: websoft9-agent
        run: |
          echo "è¿è¡Œ websoft9-agent å•å…ƒæµ‹è¯•..."
          mkdir -p reports

          # è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
          go test -v -race -coverprofile=reports/coverage.out -covermode=atomic ./... | tee reports/test-results.txt

          # ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
          if [ -f "reports/coverage.out" ]; then
            go tool cover -html=reports/coverage.out -o reports/coverage.html
            go tool cover -func=reports/coverage.out > reports/coverage.txt

            # è®¡ç®—æ€»è¦†ç›–ç‡
            total_coverage=$(go tool cover -func=reports/coverage.out | grep "total:" | awk '{print $3}' | sed 's/%//' || echo "0")
            echo "Agent æ€»è¦†ç›–ç‡: ${total_coverage}%"
            echo "agent_coverage=$total_coverage" >> $GITHUB_ENV
          fi

      - name: Upload coverage reports
        uses: actions/upload-artifact@v4
        with:
          name: coverage-reports-go${{ matrix.go-version }}
          path: |
            api-service/reports/
            websoft9-agent/reports/
          retention-days: 30

      - name: Comment coverage on PR
        if: matrix.go-version == '1.24.5'
        uses: actions/github-script@v7
        continue-on-error: true
        with:
          script: |
            try {
              const fs = require('fs');
              const path = require('path');

              // è·å–è¦†ç›–ç‡æ•°æ®
              const apiCoverage = process.env.api_coverage || '0';
              const agentCoverage = process.env.agent_coverage || '0';
              const threshold = process.env.COVERAGE_THRESHOLD;

              // è®¡ç®—å¹³å‡è¦†ç›–ç‡
              const avgCoverage = ((parseFloat(apiCoverage) + parseFloat(agentCoverage)) / 2).toFixed(1);
              const isWarning = parseFloat(avgCoverage) < parseFloat(threshold);

              let coverageIcon = 'âœ…';
              if (isWarning) {
                coverageIcon = 'âš ï¸';
              }

              let detailsSection = '';

              // å°è¯•è¯»å–è¦†ç›–ç‡è¯¦ç»†ä¿¡æ¯
              try {
                const apiCoverageFile = path.join('api-service', 'reports', 'coverage.txt');
                const agentCoverageFile = path.join('websoft9-agent', 'reports', 'coverage.txt');

                let apiDetails = '';
                let agentDetails = '';

                if (fs.existsSync(apiCoverageFile)) {
                  apiDetails = fs.readFileSync(apiCoverageFile, 'utf8');
                }

                if (fs.existsSync(agentCoverageFile)) {
                  agentDetails = fs.readFileSync(agentCoverageFile, 'utf8');
                }

                if (apiDetails || agentDetails) {
                  detailsSection = `
              <details>
              <summary>è¯¦ç»†è¦†ç›–ç‡ä¿¡æ¯</summary>

              ${apiDetails ? `**API Service:**
              \`\`\`
              ${apiDetails}
              \`\`\`
              ` : ''}

              ${agentDetails ? `**Websoft9 Agent:**
              \`\`\`
              ${agentDetails}
              \`\`\`
              ` : ''}

              </details>`;
                }
              } catch (error) {
                console.log('æ— æ³•è¯»å–è¦†ç›–ç‡è¯¦ç»†ä¿¡æ¯:', error.message);
              }

              const comment = `## ${coverageIcon} æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

              | ç»„ä»¶ | è¦†ç›–ç‡ | çŠ¶æ€ |
              |------|--------|------|
              | API Service | ${apiCoverage}% | ${parseFloat(apiCoverage) >= parseFloat(threshold) ? 'âœ…' : 'âš ï¸'} |
              | Websoft9 Agent | ${agentCoverage}% | ${parseFloat(agentCoverage) >= parseFloat(threshold) ? 'âœ…' : 'âš ï¸'} |
              | **å¹³å‡è¦†ç›–ç‡** | **${avgCoverage}%** | **${isWarning ? 'âš ï¸' : 'âœ…'}** |

              **é˜ˆå€¼:** ${threshold}%

              ${isWarning ? 'âš ï¸ **è­¦å‘Š:** éƒ¨åˆ†ç»„ä»¶è¦†ç›–ç‡ä½äºé˜ˆå€¼ï¼Œå»ºè®®å¢åŠ æµ‹è¯•ç”¨ä¾‹' : 'âœ… æ‰€æœ‰ç»„ä»¶è¦†ç›–ç‡è¾¾åˆ°è¦æ±‚'}
              ${detailsSection}
              `;

              // æŸ¥æ‰¾ç°æœ‰çš„è¦†ç›–ç‡è¯„è®º
              const { data: comments } = await github.rest.issues.listComments({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
              });

              const existingComment = comments.find(comment =>
                comment.body.includes('æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š')
              );

              if (existingComment) {
                // æ›´æ–°ç°æœ‰è¯„è®º
                await github.rest.issues.updateComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  comment_id: existingComment.id,
                  body: comment
                });
                console.log('âœ… è¦†ç›–ç‡è¯„è®ºå·²æ›´æ–°');
              } else {
                // åˆ›å»ºæ–°è¯„è®º
                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: context.issue.number,
                  body: comment
                });
                console.log('âœ… è¦†ç›–ç‡è¯„è®ºå·²åˆ›å»º');
              }
            } catch (error) {
              console.log('âš ï¸ æ— æ³•åˆ›å»ºæˆ–æ›´æ–°è¦†ç›–ç‡è¯„è®º:', error.message);
              console.log('è¦†ç›–ç‡æ•°æ®ä»ä¼šåœ¨å·¥ä½œæµæ—¥å¿—ä¸­æ˜¾ç¤º');

              // åœ¨æ§åˆ¶å°è¾“å‡ºè¦†ç›–ç‡ä¿¡æ¯ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
              const apiCoverage = process.env.api_coverage || '0';
              const agentCoverage = process.env.agent_coverage || '0';
              const threshold = process.env.COVERAGE_THRESHOLD;
              const avgCoverage = ((parseFloat(apiCoverage) + parseFloat(agentCoverage)) / 2).toFixed(1);

              console.log('ğŸ“Š æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š:');
              console.log(`API Service: ${apiCoverage}%`);
              console.log(`Websoft9 Agent: ${agentCoverage}%`);
              console.log(`å¹³å‡è¦†ç›–ç‡: ${avgCoverage}%`);
              console.log(`é˜ˆå€¼: ${threshold}%`);
            }

  # æ„å»ºéªŒè¯
  build-check:
    name: ğŸ”¨ Build Check
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service: ["api-service", "websoft9-agent"]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}

      - name: Cache Go modules
        uses: actions/cache@v4
        with:
          path: |
            ~/.cache/go-build
            ~/go/pkg/mod
          key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
          restore-keys: |
            ${{ runner.os }}-go-

      - name: Build ${{ matrix.service }}
        run: |
          # æ‰“å°å½“å‰ç›®å½•è·¯å¾„
          echo "å½“å‰å·¥ä½œç›®å½•: $(pwd)"
          echo "ç›®å½•å†…å®¹:"
          ls -la

          if [ ! -d "${{ matrix.service }}" ]; then
            echo "â­ï¸ è·³è¿‡ ${{ matrix.service }}ï¼Œç›®å½•ä¸å­˜åœ¨"
            exit 0
          fi

          echo "æ„å»º ${{ matrix.service }}..."
          cd ${{ matrix.service }}
          echo "åˆ‡æ¢åˆ°ç›®å½•: $(pwd)"

          # ä¸‹è½½ä¾èµ–
          go mod download

          # æ„å»º
          if [ -f "Makefile" ]; then
            make build
          else
            go build -v ./...
          fi

          echo "âœ… ${{ matrix.service }} æ„å»ºæˆåŠŸ"

  # å®‰å…¨æ‰«æ
  security-scan:
    name: ğŸ”’ Security Scan
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write
      actions: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GO_VERSION }}

      - name: Install Gosec
        run: |
          echo "å®‰è£… Gosec å®‰å…¨æ‰«æå·¥å…·..."
          go install github.com/securego/gosec/v2/cmd/gosec@latest

      - name: Run Gosec Security Scanner for api-service
        run: |
          echo "è¿è¡Œ api-service å®‰å…¨æ‰«æ..."

          if [ ! -d "api-service" ]; then
            echo "â­ï¸ è·³è¿‡ api-serviceï¼Œç›®å½•ä¸å­˜åœ¨"
          else
            cd api-service
            mkdir -p reports

            echo "æ‰«æ api-service Go ä»£ç ..."
            # ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            config_flag=""
            if [ -f "../.gosec.json" ]; then
              config_flag="-conf ../.gosec.json"
            fi

            if gosec $config_flag -fmt sarif -out reports/gosec-results.sarif ./... 2>/dev/null; then
              echo "âœ… api-service SARIF æŠ¥å‘Šç”ŸæˆæˆåŠŸ"
            else
              echo "âš ï¸ api-service SARIF æŠ¥å‘Šç”Ÿæˆå¤±è´¥ï¼Œå°è¯•åŸºæœ¬æ‰«æ"
              gosec $config_flag ./... || echo "âš ï¸ api-service å®‰å…¨æ‰«æå®Œæˆï¼ˆå¯èƒ½æœ‰è­¦å‘Šï¼‰"
            fi

            # ç”Ÿæˆ JSON æŠ¥å‘Šï¼ˆç”¨äºè°ƒè¯•ï¼‰
            gosec $config_flag -fmt json -out reports/gosec-results.json ./... 2>/dev/null || true
            cd ../..
          fi

      - name: Run Gosec Security Scanner for websoft9-agent
        run: |
          echo "è¿è¡Œ websoft9-agent å®‰å…¨æ‰«æ..."

          if [ ! -d "websoft9-agent" ]; then
            echo "â­ï¸ è·³è¿‡ websoft9-agentï¼Œç›®å½•ä¸å­˜åœ¨"
          else
            cd websoft9-agent
            mkdir -p reports

            echo "æ‰«æ websoft9-agent Go ä»£ç ..."
            # ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            config_flag=""
            if [ -f "../.gosec.json" ]; then
              config_flag="-conf ../.gosec.json"
            fi

            if gosec $config_flag -fmt sarif -out reports/gosec-results.sarif ./... 2>/dev/null; then
              echo "âœ… websoft9-agent SARIF æŠ¥å‘Šç”ŸæˆæˆåŠŸ"
            else
              echo "âš ï¸ websoft9-agent SARIF æŠ¥å‘Šç”Ÿæˆå¤±è´¥ï¼Œå°è¯•åŸºæœ¬æ‰«æ"
              gosec $config_flag ./... || echo "âš ï¸ websoft9-agent å®‰å…¨æ‰«æå®Œæˆï¼ˆå¯èƒ½æœ‰è­¦å‘Šï¼‰"
            fi

            # ç”Ÿæˆ JSON æŠ¥å‘Šï¼ˆç”¨äºè°ƒè¯•ï¼‰
            gosec $config_flag -fmt json -out reports/gosec-results.json ./... 2>/dev/null || true
            cd ../..
          fi

      - name: Upload Gosec scan results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: gosec-security-reports
          path: |
            api-service/reports/gosec-*
            websoft9-agent/reports/gosec-*
          retention-days: 30

      - name: Upload Gosec scan results to GitHub Security tab
        uses: github/codeql-action/upload-sarif@v3
        if: always() && hashFiles('api-service/reports/gosec-results.sarif') != ''
        with:
          sarif_file: api-service/reports/gosec-results.sarif
          category: api-service-gosec

      - name: Upload Agent Gosec scan results to GitHub Security tab
        uses: github/codeql-action/upload-sarif@v3
        if: always() && hashFiles('websoft9-agent/reports/gosec-results.sarif') != ''
        with:
          sarif_file: websoft9-agent/reports/gosec-results.sarif
          category: websoft9-agent-gosec

  # æœ€ç»ˆçŠ¶æ€æ£€æŸ¥
  pr-check-summary:
    name: ğŸ“Š PR Check Summary
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write
    needs:
      [
        commit-message-check,
        code-format-check,
        unit-tests,
        build-check,
        security-scan,
      ]
    if: always()
    steps:
      - name: Check all jobs status
        run: |
          echo "=== PR æ£€æŸ¥ç»“æœæ±‡æ€» ==="

          # æ£€æŸ¥å„ä¸ªä½œä¸šçš„çŠ¶æ€
          commit_check="${{ needs.commit-message-check.result }}"
          code_format="${{ needs.code-format-check.result }}"
          unit_tests="${{ needs.unit-tests.result }}"
          build_check="${{ needs.build-check.result }}"
          security_scan="${{ needs.security-scan.result }}"

          echo "æäº¤æ¶ˆæ¯æ£€æŸ¥: $commit_check"
          echo "ä»£ç æ ¼å¼æ£€æŸ¥: $code_format"
          echo "å•å…ƒæµ‹è¯•: $unit_tests"
          echo "æ„å»ºæ£€æŸ¥: $build_check"
          echo "å®‰å…¨æ‰«æ: $security_scan"

          # æ£€æŸ¥æ˜¯å¦æœ‰å¤±è´¥çš„ä½œä¸š
          failed_jobs=()

          [ "$commit_check" = "failure" ] && failed_jobs+=("æäº¤æ¶ˆæ¯æ£€æŸ¥")
          [ "$code_format" = "failure" ] && failed_jobs+=("ä»£ç æ ¼å¼æ£€æŸ¥")
          [ "$unit_tests" = "failure" ] && failed_jobs+=("å•å…ƒæµ‹è¯•")
          [ "$build_check" = "failure" ] && failed_jobs+=("æ„å»ºæ£€æŸ¥")
          [ "$security_scan" = "failure" ] && failed_jobs+=("å®‰å…¨æ‰«æ")

          if [ ${#failed_jobs[@]} -gt 0 ]; then
            echo ""
            echo "âŒ ä»¥ä¸‹æ£€æŸ¥å¤±è´¥:"
            for job in "${failed_jobs[@]}"; do
              echo "  - $job"
            done
            echo ""
            echo "è¯·ä¿®å¤å¤±è´¥çš„æ£€æŸ¥é¡¹åé‡æ–°æäº¤"
            exit 1
          fi

          echo ""
          echo "âœ… æ‰€æœ‰ PR æ£€æŸ¥é€šè¿‡ï¼"

      - name: Comment PR check summary
        if: always()
        uses: actions/github-script@v7
        continue-on-error: true
        with:
          script: |
            try {
              const needs = ${{ toJSON(needs) }};

              let summary = '## ğŸ“Š PR æ£€æŸ¥ç»“æœæ±‡æ€»\n\n';
              let allPassed = true;

              const jobs = [
                { name: 'æäº¤æ¶ˆæ¯æ£€æŸ¥', key: 'commit-message-check' },
                { name: 'ä»£ç æ ¼å¼æ£€æŸ¥', key: 'code-format-check' },
                { name: 'å•å…ƒæµ‹è¯•', key: 'unit-tests' },
                { name: 'æ„å»ºæ£€æŸ¥', key: 'build-check' },
                { name: 'å®‰å…¨æ‰«æ', key: 'security-scan' }
              ];

              for (const job of jobs) {
                const result = needs[job.key]?.result || 'skipped';
                let icon = 'âœ…';

                if (result === 'failure') {
                  icon = 'âŒ';
                  allPassed = false;
                } else if (result === 'cancelled') {
                  icon = 'â¹ï¸';
                } else if (result === 'skipped') {
                  icon = 'â­ï¸';
                }

                summary += `${icon} **${job.name}:** ${result}\n`;
              }

              summary += '\n';

              if (allPassed) {
                summary += 'ğŸ‰ **æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼** æ­¤ PR å¯ä»¥åˆå¹¶ã€‚';
              } else {
                summary += 'âš ï¸ **éƒ¨åˆ†æ£€æŸ¥å¤±è´¥** è¯·ä¿®å¤å¤±è´¥çš„æ£€æŸ¥é¡¹åé‡æ–°æäº¤ã€‚';
              }

              // æŸ¥æ‰¾ç°æœ‰çš„æ±‡æ€»è¯„è®º
              const { data: comments } = await github.rest.issues.listComments({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
              });

              const existingComment = comments.find(comment =>
                comment.body.includes('PR æ£€æŸ¥ç»“æœæ±‡æ€»')
              );

              if (existingComment) {
                // æ›´æ–°ç°æœ‰è¯„è®º
                await github.rest.issues.updateComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  comment_id: existingComment.id,
                  body: summary
                });
                console.log('âœ… PR æ£€æŸ¥æ±‡æ€»è¯„è®ºå·²æ›´æ–°');
              } else {
                // åˆ›å»ºæ–°è¯„è®º
                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: context.issue.number,
                  body: summary
                });
                console.log('âœ… PR æ£€æŸ¥æ±‡æ€»è¯„è®ºå·²åˆ›å»º');
              }
            } catch (error) {
              console.log('âš ï¸ æ— æ³•åˆ›å»ºæˆ–æ›´æ–° PR æ£€æŸ¥æ±‡æ€»è¯„è®º:', error.message);
              console.log('æ£€æŸ¥ç»“æœä»ä¼šåœ¨å·¥ä½œæµæ—¥å¿—ä¸­æ˜¾ç¤º');

              // åœ¨æ§åˆ¶å°è¾“å‡ºæ±‡æ€»ä¿¡æ¯ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
              const needs = ${{ toJSON(needs) }};
              console.log('ğŸ“Š PR æ£€æŸ¥ç»“æœæ±‡æ€»:');

              const jobs = [
                { name: 'æäº¤æ¶ˆæ¯æ£€æŸ¥', key: 'commit-message-check' },
                { name: 'ä»£ç æ ¼å¼æ£€æŸ¥', key: 'code-format-check' },
                { name: 'å•å…ƒæµ‹è¯•', key: 'unit-tests' },
                { name: 'æ„å»ºæ£€æŸ¥', key: 'build-check' },
                { name: 'å®‰å…¨æ‰«æ', key: 'security-scan' }
              ];

              for (const job of jobs) {
                const result = needs[job.key]?.result || 'skipped';
                console.log(`${job.name}: ${result}`);
              }
            }
